name: linear-to-implementation
version: 1.0

phases:
  - id: discover
    tasks:
      - id: fetch
        agent: orchestrator
        op: fetch_linear
        in: {ticketId: "{{p.ticketId}}"}
        out: linearIssue

      - id: analyze
        agent: orchestrator
        op: analyze
        in: {issue: "$from.linearIssue"}
        out: context

  - id: design
    gate: "$from.context.hasFigma"
    error: skip
    tasks:
      - id: analyze
        agent: figma-design-analyzer
        parallel: true
        in: {urls: "$from.linearIssue.figmaUrls", fw: "react", lang: "ts"}
        out: "figmaSpecs[]"

  - id: impl
    gate: "$from.context.components > 0"
    tasks:
      - id: build
        agent: senior-frontend-engineer
        parallel: true
        in: {specs: "$from.figmaSpecs", issue: "$from.linearIssue", idx: "{{loop}}"}
        out: "impls[]"

  - id: verify
    tasks:
      - id: type
        agent: orchestrator
        op: cmd
        in: {cmds: ["npm run type-check"]}
        out: typeRes

      - id: test
        agent: orchestrator
        op: cmd
        in: {cmds: ["npm run test:run"]}
        out: testRes

      - id: visual
        agent: playwright-dev-tester
        in: {specs: "$from.figmaSpecs", impls: "$from.impls"}
        out: visualRes

  - id: integrate
    tasks:
      - id: mount
        agent: orchestrator
        op: mount
        in: {comps: "$from.impls"}
        out: mounted

  - id: cleanup
    error: skip
    tasks:
      - id: clean
        agent: orchestrator
        op: cleanup
        in: {patterns: ["mcp/tests/temp-*", "docs/project/*-spec*.md"]}
        out: cleaned

  - id: done
    tasks:
      - id: update
        agent: orchestrator
        op: update_linear
        in: {id: "$from.linearIssue.id", status: "Done", msg: "âœ… Implementation complete. Live at http://localhost:3000"}
        out: updated
