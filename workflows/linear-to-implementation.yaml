name: linear-to-implementation
version: 1.0
description: |
  Convert Linear ticket to fully implemented, tested, and deployed components.
  Workflow: Linear ticket → PRD (optional) → Figma analysis → Implementation → Testing → Completion

phases:
  # PHASE 1: DISCOVERY
  - id: discovery
    name: "Discovery - Fetch Ticket & Analyze"
    type: discovery
    tasks:
      - id: fetch_ticket
        agent: orchestrator
        operation: fetch_linear_issue
        input:
          ticketId: "{{parameters.ticketId}}"
        output:
          storeAs: linearIssue

      - id: analyze_context
        agent: orchestrator
        operation: analyze_context
        input:
          issue: "$from.linearIssue"
        output:
          storeAs: workflowContext

  # PHASE 2: PRD GENERATION (Optional)
  - id: prd_generation
    name: "PRD Generation - Document Requirements"
    type: processing
    gateCondition: "{{parameters.withPRD}}"
    errorRecovery: skip
    tasks:
      - id: generate_prd
        agent: prd-writer
        operation: delegate
        input:
          context:
            issueTitle: "$from.linearIssue.title"
            issueDescription: "$from.linearIssue.description"
            clientFrameworks: "react"
            clientLanguages: "typescript"
        output:
          storeAs: prd

  # PHASE 3: DESIGN ANALYSIS (Parallel if multiple designs)
  - id: design_analysis
    name: "Design Analysis - Extract Specs from Figma"
    type: processing
    gateCondition: "$from.workflowContext.hasFigmaDesigns"
    errorRecovery: skip
    tasks:
      - id: analyze_designs
        agent: figma-design-analyzer
        operation: delegate
        parallel: true
        input:
          context:
            figmaUrls: "$from.linearIssue.figmaUrls"
            clientFrameworks: "react"
            clientLanguages: "typescript"
        output:
          storeAs: figmaSpecs[]

  # PHASE 4: IMPLEMENTATION (Parallel - one engineer per component)
  - id: implementation
    name: "Implementation - Build Components"
    type: implementation
    gateCondition: "$from.workflowContext.componentCount > 0"
    tasks:
      - id: implement_components
        agent: senior-frontend-engineer
        operation: delegate
        parallel: true
        input:
          context:
            figmaSpecs: "$from.figmaSpecs"
            prd: "$from.prd"
            linearIssue: "$from.linearIssue"
            componentIndex: "{{loop.index}}"
        output:
          storeAs: implementations[]

  # PHASE 5: VERIFICATION
  - id: verification
    name: "Verification - Type Check & Tests"
    type: verification
    tasks:
      - id: type_check
        agent: orchestrator
        operation: execute_command
        input:
          commands:
            - "npm run type-check"
        output:
          storeAs: typeCheckResult

      - id: run_tests
        agent: orchestrator
        operation: execute_command
        input:
          commands:
            - "npm run test:run"
        output:
          storeAs: testResult

      - id: visual_verification
        agent: playwright-dev-tester
        operation: delegate
        input:
          context:
            figmaSpecs: "$from.figmaSpecs"
            implementations: "$from.implementations"
        output:
          storeAs: visualTestResult

  # PHASE 6: INTEGRATION
  - id: integration
    name: "Integration - Mount Components in App"
    type: implementation
    tasks:
      - id: mount_components
        agent: orchestrator
        operation: mount_component
        input:
          components: "$from.implementations"
        output:
          storeAs: mountResult

  # PHASE 7: CLEANUP
  - id: cleanup
    name: "Cleanup - Remove Temporary Files"
    type: verification
    errorRecovery: skip
    tasks:
      - id: cleanup_files
        agent: orchestrator
        operation: cleanup
        input:
          patterns:
            - "mcp/tests/temp-*.ts"
            - "mcp/tests/test-*.ts"
            - "mcp/tests/analyze-*.ts"
            - "docs/project/*-design-spec*.md"
        output:
          storeAs: cleanupResult

  # PHASE 8: COMPLETION
  - id: completion
    name: "Completion - Report Results"
    type: verification
    tasks:
      - id: update_linear
        agent: orchestrator
        operation: update_linear_issue
        input:
          ticketId: "$from.linearIssue.id"
          status: "Done"
          comment: |
            ✅ Implementation complete!

            Components implemented: {{implementations.length}}
            Tests: All passing
            Type-check: Passed
            Live: http://localhost:3000

            Changes:
            - Components mounted in src/App.tsx
            - Storybook stories created
            - Unit tests created and passing
            - Visual tests completed
            - Screenshots: docs/temp/playwright-screenshots/

            Workflow duration: {{totalDuration}}
        output:
          storeAs: updateLinearResult

      - id: log_completion
        agent: orchestrator
        operation: execute_command
        input:
          commands:
            - "echo '✅ Workflow complete: {{workflowName}}' && date"
        output:
          storeAs: completionLog
