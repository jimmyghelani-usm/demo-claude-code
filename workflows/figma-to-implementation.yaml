name: figma-to-implementation
version: 1.0

phases:
  - id: discover
    tasks:
      - id: parse
        agent: orchestrator
        op: parse
        in: {urls: "{{p.urls}}"}
        out: context

  - id: design
    tasks:
      - id: analyze
        agent: figma-design-analyzer
        parallel: true
        in: {urls: "{{p.urls}}", fw: "react", lang: "ts"}
        out: "figmaSpecs[]"

  - id: impl
    tasks:
      - id: build
        agent: senior-frontend-engineer
        parallel: true
        in: {specs: "$from.figmaSpecs", idx: "{{loop}}"}
        out: "impls[]"

  - id: verify
    tasks:
      - id: type
        agent: orchestrator
        op: cmd
        in: {cmds: ["npm run type-check"]}
        out: typeRes

      - id: test
        agent: orchestrator
        op: cmd
        in: {cmds: ["npm run test:run"]}
        out: testRes

      - id: visual
        agent: playwright-dev-tester
        in: {specs: "$from.figmaSpecs", impls: "$from.impls"}
        out: visualRes

  - id: integrate
    tasks:
      - id: mount
        agent: orchestrator
        op: mount
        in: {comps: "$from.impls"}
        out: mounted

  - id: cleanup
    error: skip
    tasks:
      - id: clean
        agent: orchestrator
        op: cleanup
        in: {patterns: ["mcp/tests/temp-*", "docs/project/*-spec*.md"]}
        out: cleaned

  - id: done
    tasks:
      - id: report
        agent: orchestrator
        op: cmd
        in: {cmds: ["echo '✅ Figma → Implementation complete' && date"]}
        out: logged
